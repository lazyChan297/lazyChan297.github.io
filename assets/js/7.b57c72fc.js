(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{364:function(t,e,a){"use strict";a.r(e);var v=a(45),_=Object(v.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"浏览器缓存机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存机制"}},[t._v("#")]),t._v(" 浏览器缓存机制")]),t._v(" "),a("h2",{attrs:{id:"缓存的位置和读取顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存的位置和读取顺序"}},[t._v("#")]),t._v(" 缓存的位置和读取顺序")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("service worker")]),t._v("\n运行在浏览器的独立线程中，可以根据自己的需求来匹配缓存的内容、读取缓存。当用户访问资源前拦截请求，如果缓存生效则读取缓存的文件，否则发起请求"),a("br")]),t._v(" "),a("li",[a("strong",[t._v("memory cache")]),t._v(" 内存中的缓存，一旦该进程被释放缓存就失效，读取速度快但是由于占用CPU内存所以可以缓存的资源很有限")]),t._v(" "),a("li",[a("strong",[t._v("dick cache")]),t._v(" 硬盘缓存读取速度慢于内存，但是存储容量和保存时效都要优于内存缓存")]),t._v(" "),a("li",[a("strong",[t._v("push cache")])])]),t._v(" "),a("p",[t._v("如果service worker匹配了缓存，那么会拦截网络请求，直接返回匹配缓存资源的文件。如果没有使用service worker，那么根据Http Header判断使用哪种缓存策略来获取资源")]),t._v(" "),a("h2",{attrs:{id:"强弱缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强弱缓存"}},[t._v("#")]),t._v(" 强弱缓存")]),t._v(" "),a("p",[t._v("根据是否需要向服务器发起请求区分了强弱缓存，强缓存不会发起直接返回缓存资源，而是从memory cache 或 disk cache中获取资源，返回200。弱缓存则携带缓存标识向服务器发起请求，服务器根据"),a("code",[t._v("Etag")]),t._v("或"),a("code",[t._v("Last-Modified")]),t._v("判断资源是否更新，没有更新无内容返回，返回304；更新则返回最新资源，返回200")]),t._v(" "),a("h3",{attrs:{id:"强缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),a("p",[t._v("实现的方式有两种，第一种通过expires结合Last-Modified进行比较资源是否过期，这两个标识会携带在服务端的response头部中 "),a("br")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("字段说明")]),t._v(" "),a("p",[t._v("Expires: 服务端response携带的标识，表示该资源在服务端过期时间 "),a("br"),t._v("\nLast-Modified: 该资源在服务端最后一次修改的时间")])]),t._v(" "),a("p",[t._v("如果上一次修改资源时间和资源有限缓存时间判断。")]),t._v(" "),a("p",[t._v("第二种通过设置Cache-Control字段里的值来实现，"),a("code",[t._v("no-cache")]),t._v("表示不使用强缓存")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Cache-Control字段说明")]),t._v(" "),a("ul",[a("li",[t._v("public 浏览器&客服端都可以缓存")]),t._v(" "),a("li",[t._v("private 只有浏览器可以缓存")]),t._v(" "),a("li",[t._v("max-age=300 缓存5分钟后过期需要重新缓存")]),t._v(" "),a("li",[t._v("s-maxage=300 与max-age一致，但只在代理服务器生效")]),t._v(" "),a("li",[t._v("no-store 不缓存任何内容")]),t._v(" "),a("li",[t._v("no-cache 使用Etag or Last-Modified判断")]),t._v(" "),a("li",[t._v("max-stale=30 能够容忍的最大过期时间，表示浏览器愿意接收一个最多过期30秒的资源")]),t._v(" "),a("li",[t._v("min-fresh=30 能够容忍的最小新鲜度，表示浏览器不愿意接受新鲜度小于30秒的资源")])])]),t._v(" "),a("p",[a("code",[t._v("Cache-Control")]),t._v("和"),a("code",[t._v("Expires")]),t._v("同时存在时，"),a("code",[t._v("Cache-Control")]),t._v("的优先级高于"),a("code",[t._v("Expires")]),t._v("，如果当前环境是不支持HTTP1.1的环境，那么会使用"),a("code",[t._v("Expires")])]),t._v(" "),a("h3",{attrs:{id:"协商缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),a("p",[t._v("当强缓存失效后，浏览器会携带一些字段向服务器发起请求，根据字段值来决定是否返回资源")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("字段说明")]),t._v(" "),a("ul",[a("li",[t._v("Etag: 通过对该资源内容计算的hash值（服务器返回）")]),t._v(" "),a("li",[t._v("If-None-Match: 上一次向服务器发起请求返回的Etag的值")]),t._v(" "),a("li",[t._v("Last-Modified: 该资源在服务器最后修改的时间")]),t._v(" "),a("li",[t._v("If-Modified-Since: 上一次向服务器发起请求返回的Last-Modified的值")])])]),t._v(" "),a("h4",{attrs:{id:"etag和if-none-match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etag和if-none-match"}},[t._v("#")]),t._v(" Etag和If-None-Match")]),t._v(" "),a("p",[t._v("当浏览器第一次向服务端请求资源时，如果response的相应头有Etag这个字段，"),a("br"),t._v("\n那么下一次浏览器发送请求时，会在request的请求头携带"),a("code",[t._v("If-None-Match")]),t._v("字段，值时上一次请求返回的"),a("code",[t._v("Etag")]),t._v(" "),a("br"),t._v("\n服务端会对"),a("code",[t._v("If-None-Match")]),t._v("和"),a("code",[t._v("Etag")]),t._v("进行比较，如果一致告知浏览器资源没有发生改变，返回浏览器缓存内容"),a("br"),t._v("\n否则返回最新的资源")]),t._v(" "),a("h4",{attrs:{id:"last-modified和if-modified-since"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#last-modified和if-modified-since"}},[t._v("#")]),t._v(" Last-Modified和If-Modified-Since")]),t._v(" "),a("p",[t._v("当浏览器第一次向服务端请求资源时，如果response的相应头有Last-Modified这个字段，"),a("br"),t._v("\n那么下一次浏览器发送请求时，会在request的请求头携带"),a("code",[t._v("If-Modified-Since")]),t._v("字段，值时上一次请求返回的"),a("code",[t._v("Last-Modified")]),t._v(" "),a("br"),t._v("\n服务端会对"),a("code",[t._v("Last-Modified")]),t._v("和"),a("code",[t._v("If-Modified-Since")]),t._v("进行比较，如果一致告知浏览器资源没有发生改变，返回浏览器缓存内容"),a("br"),t._v("\n否则返回最新的资源")]),t._v(" "),a("h4",{attrs:{id:"etag和last-modified对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etag和last-modified对比"}},[t._v("#")]),t._v(" Etag和Last-Modified对比")]),t._v(" "),a("ul",[a("li",[t._v("在缓存精度上，Etag优于Last-Modified"),a("br"),t._v("\n因为，如果本地打开了该资源虽然没有进行修改，但是Last-Modified值仍然会被影响，导致缓存失效，Last-Modified的计时是以秒为单位"),a("br"),t._v("\n一种边界情况是当资源在一秒内被修改多次，那么Last-Modified无效")]),t._v(" "),a("li",[t._v("在性能上，Last-Modified的消耗小于Etag，因为Etag需要服务器通过算法计算资源内容有没有发生改变生成hash值")]),t._v(" "),a("li",[t._v("服务器校验优先级Etag>Last-Modified")])]),t._v(" "),a("h3",{attrs:{id:"两种缓存机制的优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两种缓存机制的优先级"}},[t._v("#")]),t._v(" 两种缓存机制的优先级")]),t._v(" "),a("p",[t._v("强缓存优先级高于协商缓存，当浏览器向服务器请求资源时 "),a("br"),t._v("\n会先判断强缓存是否生效，如果生效直接读取缓存内容"),a("br"),t._v("\n否则，根据携带的标识（If-Modified-Since或者If-None-Match)向服务器发起请求判断缓存是否过期"),a("br"),t._v("\n如果没有，直接返回304，使用缓存的内容"),a("br"),t._v("\n如果有，返回200，返回最新的资源")]),t._v(" "),a("h3",{attrs:{id:"实际应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实际应用场景"}},[t._v("#")]),t._v(" 实际应用场景")]),t._v(" "),a("p",[t._v("不经常修改的资源，例如第三方库，一些静态资源可以使用强缓存"),a("br"),t._v("\n经常修改的资源，可以使用"),a("code",[t._v("Cache-Control: no-cache")]),t._v("，结合需求给response配置标识 "),a("br")]),t._v(" "),a("h2",{attrs:{id:"参考内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考内容"}},[t._v("#")]),t._v(" 参考内容")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/115243059",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于service worker"),a("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=_.exports}}]);